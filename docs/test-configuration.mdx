---
title: 'Test configuration'
---

import { SnippetGroup } from '@/components/SnippetGroup'

The data tests configuration is defined in `.yml` files in your dbt project.
You can change and adjust the configuration anytime, and the elementary on-run-end macro will upload the most recent version on every `dbt run` you execute.

Elementary tests have three levels of configurations:

1. [Test arguments](#test-arguments) - Test specific arguments.
2. [Table configuration](#configure-timestamp-column-for-dbt-models) - Configure the timestamp column and details of a monitored table.
3. [Global vars](#data-monitoring-global-vars) - Optional configuration parameters of the operation.

Each time you run `dbt test`, elementary data monitors will use this configuration.

To learn how to add these tests, [go here](/add-data-monitoring-tests).

## Understanding data tests configuration
The configuration of Elementary monitors is dbt native, meaning we follow the format and priorities of `dbt configuration`.

You can configure elementary tests to monitor dbt models and dbt sources. 
Tables that are not part of the dbt project can also be monitored, just add these as sources to the project (no need to refer from any model).

For dbt models and sources, elementary searches and prioritizes configuration in the following order:

1. Test arguments.
2. Model `config` (timestamp_column only).
3. Global vars in `dbt_project.yml`.

---

## Test arguments

`timestamp_column`: [column name]

It is recommended to configure a timestamp column (if there is one). The best column for this will have an 'updated at' timestamp for each row (date type also works).
Elementary will use this column to filter the table when running monitors. 
If undefined, _default is null_ (no time buckets).  
(`timestamp_column` can be defined for the whole table as well).

`sensitivity`:

Threshold for the anomaly sensitivity, the [global default](/add-data-monitoring-tests) is 3. If defined for a test, the test param is used instead of the global one.
A higher number means less sensitivity (less anomalies), and a lower number means more sensitivity (more anomalies).

`backfill_days`:

The minimal amount of buckets for running time buckets monitors. If these buckets were already calculated, Elementary will overwrite them. The reason behind it is to monitor recent backfills of data, if there were any. 
This configuration should be changed according to your data delays. 
If undefined, _default is 2 buckets_.

`exclude_regexp`:

Param for the `all_columns_anomalies` test only, which enables to exclude a column from the tests based on regular expression match. Example usage: `exlude_regexp: '.*SDC$'`

`exclude_prefix`:
Param for the `all_columns_anomalies` test only, which enables to exclude a column from the tests based on prefix match. Example usage: `exlude_prefix: 'dbt_'`

---

## Table timestamp column

Elementary tests use a timestamp column to filter data and divide it into time buckets (read more about [how Elementary tests work](/data-anomaly-detection#how-do-monitors-work-in-elementary-data-tests)).

A timestamp column can be configured in two places:

1. [Test param](/test-configuration#test-arguments) - Will apply to the test in which it is configured. 
2. Table configuration - Will apply to any test defined on the table that has no `timestamp_column` param.

To configure a timestamp column for a monitored table, under a model config key, add a key named elementary, and configure:

**timestamp_column**: [column name]

It is recommended to configure a timestamp column (if there is one). The best column for this will have an 'updated at' timestamp for each row (date type also works).
Elementary will use this column to filter the table when running monitors. 
If undefined, _default is null_ (no time buckets).  

### Configure timestamp_column for dbt models

<SnippetGroup>

```yml properties.yml
version: 2

models:
  - name: <model_name>
    config:
      elementary:
        timestamp_column: < model timestamp column >
    tests:
        < here you will add elementary monitors as tests >  
                
  - name: <your model with no timestamp>
    ## if no timestamp is configured, elementary will monitor without time filtering
    tests:
        <here you will add elementary monitors as tests>  
```

```yml Example
version: 2

models:
  - name: login_events
    config:
      elementary:
        timestamp_column: updated_at
    tests:
       - elementary.table_anomalies:
          tags: ['elementary']
       - elementary.all_columns_anomalies:
          tags: ['elementary']
                
  - name: users
    ## if no timestamp is configured, elementary will monitor without time filtering
    tests:
       - elementary.table_anomalies:
          tags: ['elementary']   
```

</SnippetGroup>

### Configure timestamp_column for non-dbt tables / dbt sources

Any table/view in the data warehouse that is not a dbt model can be monitored as a dbt source (even if it is not used by models in the project). 
Note that sources don't have a 'config' key, so the configuration for elementary is under the 'meta' key. 
As these tables are not part of your project, you will need to detail the database and schema name:

<SnippetGroup>

```yml sources_properties.yml
sources:
  - name: < some name >
    database: < datatbase >
    schema: < schema >
    tables: 
      - name: < table_name >
      ## sources don't have config, so elementary config is placed under 'meta'
        meta:
          elementary:
            timestamp_column: < source timestamp column >
        tests:
            <here you will add elementary monitors as tests>  
```

```yml Example
sources:
  - name: 'my_non_dbt_table'
    database: 'raw_events'
    schema: 'product'
    tables: 
      - name: 'raw_product_login_events'
      ## sources don't have config, so elementary config is placed under 'meta'
        meta:
          elementary:
            timestamp_column: 'loaded_at'
        tests:
          - elementary.table_anomalies
          - elementary.all_columns_anomalies:
              column_anomalies:
                - null_count
                - missing_count
                - zero_count
         columns:
          - name: user_id
            tests:
              - elementary.column_anomalies
```

</SnippetGroup>

---

## Data monitoring global vars

Elementary has several global vars used for configurations. You can change their defaults by adding them with a new value in your `dbt_project.yml` under the vars key.

`days_back`: [int]

The maximum timeframe for running [time buckets]() monitors, as well as to calculate a baseline for anomaly detection. 
This limit is applied in three cases: 
    - On the first run of elementary or on full refresh (first run for all tables).
    - For each new table that is added to the monitoring (first run for table).
    - On each new metric that is added to the configuration (first run of new metric).
    - If there was a gap bigger than this limit since the last run.  
If undefined, _default is 14 days back_.

`backfill_days`: [int]

The minimal amount of buckets for running time buckets monitors. If these buckets were already calculated, Elementary will overwrite them. The reason behind it is to monitor recent backfills of data, if there were any. This configuration should be changed according to your data delays. 
If undefined, _default is 2 buckets_.

`anomaly_sensitivity`: [int]

This threshold determines the sensitivity level for anomaly detection. Elementary uses [statistical analysis]() to grade deviations of recent metrics from historical metrics. Increasing this threshold makes the detection less sensitive for anomalies, and reducing makes it more sensitive (smaller deviations will be flagged as anomalies. 
If undefined, _default threshold is 3_.

`elementary_alerts_ignore_warn`: [bool]

This flag determines if elementary should alert on tests warnings or failures and errors only.
If undefined, _default flag is false_.

```yml dbt_project.yml
# optional #
# Global vars for data monitoring#
vars:
    days_back: 14   # maximum timeframe for collecting metrics and analyzing anomalies
    anomaly_score_threshold: 3   # sensitivity of anomaly detection
    backfill_days: 2   # days to backfill on each run, adjust to your data delays
    elementary_alerts_ignore_warn: true  # ignorning tests warning (alerting only failures and errors) 
```

---

## Configure Slack alerts

Alerts on changes detected can be sent via Slack when you run `edr monitor`.

Configure Slack integration by creating an app for Elementary and adding the `Token/Webhook` to `config.yml`. Refer to [this guide](/slack) for detailed instructions.